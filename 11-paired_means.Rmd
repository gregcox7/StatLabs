# Inference for paired data {#lab11}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = 'hold')
# knitr::opts_chunk$set(class.source = 'Rcode')
knitr::opts_chunk$set(
  class.output  = "Rout text-muted",
  class.message = "Rout text-info",
  class.warning = "Rout text-warning",
  class.error   = "Rout text-danger"
)

set.seed(12222)
```

```{r, echo=FALSE, out.width="100%"}
knitr::include_graphics("img/lullaby.png")
```

In this session, we will use R to conduct inference with *paired* data.  Like in the previous session, we are interested in comparing two sets of numbers.  But because each observation in one set is *paired* with an observation in the other set, the techniques for doing inference amount to the same ones we learned when dealing with just a single set of numbers.  This is because we treat the **difference within a pair** as our object of study.

## Required packages

For this session, we are going to need to load both our standard `tidyverse` package as well as the `infer` package from R's library.

```{r}
library(tidyverse)
library(infer)
```

## Do infants prefer people who sing familiar songs?

Sam Mehr, Lee Ann Song (aptly named), and Liz Spelke [@MehrEtAl2016] were interested in how infants use music as a social cue.  When an infant sees someone for the first time, are they more likely to be attracted to that person if they sing a song that the infant already knows?

@MehrEtAl2016 conducted an experiment in which a child's parents were taught a new melody and were instructed to sing it to their child at home over the course of 1--2 weeks.  After this exposure period, the parents brought their infant back to the lab.  The infant was seated in front of a screen showing videos of two adults the infant had never seen before.  At first, the two adults just smiled in silence.  They recorded the proportion of the time that the infant looked at each stranger during this "before" phase.  Then, one of these people sang the melody that the parents had been singing for 1--2 weeks, while the other sang a totally new song.  Finally, during the "after" phase, the infant saw the same videos of each person silently smiling and the researchers recorded the proportion of the time spent looking at the person who sang the familiar song.  Will infants tend to look more at the stranger who sang the familiar song?

### Check out the data

First, let's get the data into R:

```{r}
lullaby <- read_csv("https://raw.githubusercontent.com/gregcox7/StatLabs/main/data/lullaby_wide.csv")

lullaby
```

Have a look at the data by clicking on `lullaby` in RStudio's "Environment" pane.  Each row is data from a specific infant.  There are three variables in this dataset:

* "id": A number identifying each infant in the study.
* "Before": In the phase before the infants heard anyone sing, what proportion of the time did they look at the person who would eventually sing the familiar melody?
* "After": In the phase after the infants heard the two people sing, what proportion of the time did they look at the person who sang the familiar melody?

::: {.exercise}

Answer the following questions based on your understanding of how the study was designed:

a. If an infant showed no preference during either the Before or After phase, what proportion of the time in that phase would they spend looking at the person who sang the familiar melody?
b. If an infant did not change who they looked at after hearing each person sing, what would the difference in looking proportions be between the Before and After phase?

:::

### Examine the distribution of differences

Our **research question** is whether hearing the two people sing affected infant's viewing preferences.  As a result, we are interested in the **difference** between `After` and `Before`.  To find this for each infant, we will use R's `mutate` function:

::: {.exercise}

Run this chunk of code and examine the result:

```{r}
lullaby %>%
    mutate(diff = After - Before)
```

a. In your own words, describe what the line of code `mutate(diff = After - Before)` did.
b. Refer to the description of the study given above.  What does a positive value of `diff` say about how an infant's looking preferences changed?  What does a negative value of `diff` say about how their preferences changed?

:::

The nice thing about that `mutate` line is that we can add more code after it that uses the `diff` variable we created in that line.  For example, we can make a histogram of the differences in looking time from before to after:

```{r}
lullaby %>%
    mutate(diff = After - Before) %>%
    ggplot(aes(x = diff)) +
    geom_histogram(binwidth = 0.1)
```

::: {.exercise}

Refer to the histogram we just made of the `diff`erences in looking times from Before to After hearing the people sing.

a. Describe the shape of the distribution (be sure to note the number of modes, skewness, and whether there may be any outliers).
b. Based on the histogram, do these data appear to satisfy the conditions required for using a mathematical model (specifically, the T distribution)?  Why or why not?
c. Based on the histogram, does it seem like the average preference may have changed after hearing the people sing?  If so, in what direction?

:::

### Confidence interval by bootstrapping

::: {.exercise}

To begin, let's use bootstrapping to construct a **confidence interval** for the difference in looking proportion between Before and After.  This confidence interval will describe how much hearing someone sing a familiar melody changes infants' looking preferences.

Fill in the blanks in the code below to construct a **95% confidence interval** for the mean difference in looking proportion from before to after.  Be sure to refer to code from earlier in the session, as well as previous labs, for guidance.  (*Hint:* if you're looking for the name of the response variable, remember that we are doing inference about a *difference*.)

```{r eval = FALSE}
boot_dist <- lullaby %>%
    ___(diff = After - Before) %>%
    specify(response = ___) %>%
    generate(reps = 1000, type = "___") %>%
    calculate(stat = "___")

boot_ci <- boot_dist %>%
    get_confidence_interval(level = ___)

boot_dist %>%
    visualize() +
    shade_confidence_interval(boot_ci)
```

a. What code did you use?
b. Based on the confidence interval you found, is there evidence for a significance difference in looking preferences from before to after hearing the people sing?  Explain your reasoning.

:::

### Hypothesis test via mathematical model

::: {.exercise}

Next, we will use a mathematical model to conduct a hypothesis test.  This hypothesis test will address the **research question**, "is there a difference in infants' average looking behavior from before to after hearing the two strangers sing?"

a. What are the null and alternative hypotheses corresponding to our research question?
b. Fill in the blanks in the code below to calculate the **T score** for the observed data.  What code did you use?  (*Hint:* for `mu`, remember the null hypothesis.)

```{r eval=FALSE}
obs_t_diff <- lullaby %>%
    ___(diff = After - Before) %>%
    specify(response = ___) %>%
    hypothesize(null = "point", mu = ___) %>%
    calculate(stat = "t")
```

c. Fill in the blanks in the code below to visualize where the observed T score falls on the null distribution.  Based on the visualization you made, would our observed data be likely or unlikely if the null hypothesis were true?  (*Hint:* for the last blank, check how we have filled it in in previous labs depending on what our alternative hypothesis is.)

```{r eval=FALSE}
null_dist <- lullaby %>%
    ___(diff = After - Before) %>%
    specify(response = ___) %>%
    hypothesize(null = "point", mu = ___) %>%
    assume("t")

null_dist %>%
    visualize() +
    shade_p_value(obs_stat = obs_t_diff, direction = "___")
```

d. Fill in the blanks in the code below to get the $p$ value.  What did you get for the $p$ value?

```{r eval=FALSE}
null_dist %>%
    get_p_value(obs_stat = obs_t_diff, direction = "___")
```

e. If we adopt a significance level of 0.05, do we reject the null hypothesis or not?  Why or why not?
f. Give a one-sentence summary of what the outcome of this hypothesis test tells us about how infant looking behavior is affected by hearing someone sing a familiar melody.

:::

## Wrap-up

In this session, we used R to do inference on paired data, where we are typically interested in whether there is a difference within pairs of observations on average.  We used R's `mutate` function to compute the differences within each participant.  We then used bootstrapping to construct a confidence interval and a mathematical model to conduct a hypothesis test.  In the end, we were able to address the question of whether infants respond favorably (by looking more) to a stranger who sings a familiar song, giving us insight into the potential social importance of music.